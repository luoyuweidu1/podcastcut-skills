<!--
input: subtitles_words.json (isGap=true 的元素)
output: 长静音索引列表
pos: 规则，必删优先级

架构守护者：一旦我被修改，请同步更新：
1. 所属文件夹的 README.md
-->

# 静音段处理（播客版）

## 阈值规则（播客专用）

| 静音长度 | 处理 | 说明 |
|---------|------|------|
| ≤ 0.8秒 | **忽略** - 自然停顿 | 播客需要呼吸空间 |
| 0.8-2秒 | **标记删除** - 保留0.8s自然停顿 | 删除超出部分 |
| 2-5秒 | **建议删除** - 明显卡顿 | 根据上下文判断 |
| > 5秒 | **必须删除** - 严重问题 | 剪辑事故或技术问题 |

> **用户反馈 (zihao 2026-02-22)**：0.8s 阈值是偏好值，句首停顿尤其明显。

## 播客特殊考虑

### 多人对话
- 对话轮换之间的停顿（1-1.5秒）是正常的，**不要删除**
- 问题提出后的思考时间（1-2秒）**应该保留**
- 只有异常长的停顿才需要处理

### 单人播客
- 可以比多人对话更紧凑
- 但思考停顿（1-1.5秒）仍应适度保留
- 2秒以上才考虑删除

## 输出格式

**整段标记，不拆分**

示例：3.2 秒静音 → 输出 1 条
```
| 64-66 | 12.86-15.80 | 静音3.2s | 超过2秒阈值 | 删 |
```

示例：1.5 秒静音 → 通常保留
```
| 64-66 | 12.86-14.36 | 静音1.5s | 自然停顿 | 保留 |
```

用户在审核网页中可以调整决策。

## 特殊情况

### 长静音
连续 5s+ 的静音整段标记，预选删除：
```
| 323-371 | 71.38-131.38 | 静音60s | 严重异常 | 删 |
```

### 开头/结尾静音
- 播客开头的静音（>0.5秒）建议删除 — 开头容忍度更低，短停顿也应标记
- 结尾静音看情况，可能是淡出效果
- **注意**：开头部分（前 5 分钟）的静音阈值应比正文更低，因为听众第一印象很重要

### 句首停顿显示
- 静音间隙在 fine_analysis 中被分配给**前一个句子**（包含 gap 前最后一个词的句子）
- 但用户审查时，停顿感知在**下一个句子开头**
- **解决方案**：`generate_review_enhanced.js` 将每个 silence 编辑同时传给下一句作为 `incomingSilences`，审查页在句首显示 `⏸ -Xs` 标记
- 标记可点击切换（与原 silence 编辑联动同一个 fineEdit idx）

### 合并间隙二次扫描（Post-merge gap cleanup）

**问题**：规则层在**原始时间线**上检测静音。但删除内容（填充词、自我纠正、整句删除等）后，前后的短静音会合并成更长的间隙。

**示例**：
```
原始: [词A] 0.3s [删除段] 0.6s [词B]
删后: [词A] --------0.9s-------- [词B]  ← 超过 0.8s 阈值但未被检测！
```

**解决方案**：在 merge（rules + LLM）完成后，执行二次扫描：
1. 收集所有删除范围（fine edits + 5a 句子级删除）
2. 合并重叠范围
3. 模拟删除后时间线，计算相邻保留词之间的间隙
4. 间隙 > 0.8s → 添加 `silence_merged` 编辑，裁剪至 0.8s

**实现位置**：`merge_llm_fine.js` 的 merge 步骤末尾

> **用户反馈 (lucia 2026-02-24)**：删除填充词"嗯。"后，前后静音合并成 2.0s 间隙。需要 post-merge 扫描修复。实测该期播客发现 134 个合并间隙，额外裁剪 182 秒。

### 成品静音裁剪（步骤 8b）

Post-merge gap cleanup 是在 merge 阶段基于**预测**的修复。但用户在审查稿中的手动编辑（恢复/删除）会产生新的合并间隙，预测不准。

**最终保障**：`trim_silences.py` 直接在成品 MP3 上用 silencedetect 扫描，裁掉所有 >0.8s 的停顿。不需要词级数据或 delete_segments，纯音频层面操作。

**参数注意**：
- 检测阈值 (--threshold) = 0.8s
- 保留目标 (--target) = 0.6s（比阈值低 0.2s）
- 原因：silencedetect 的边界和裁切点不完全对齐，0.6s 保留量确保裁后不超 0.85s

> **用户反馈 (lucia 2026-02-24)**：成品仍有 322 个 >0.8s 停顿（最长 2.76s），用 trim_silences.py 裁剪后解决，额外节省 98s。

### 句中 vs 句间停顿感知差异

**句间**停顿 0.8s 完全自然（换气、消化），但**句中**删词后哪怕 0.3s 的间隙都会被感知为"卡了"。

**规则**：删除句中内容（stutter、self_correction、句内 filler）时，删除范围必须扩展到 `[prev_word.end, next_word.start]`，确保前后词无缝拼接。

> **用户反馈 (lucia 2026-02-24)**：s49 删了句中 "他也"，间隙 0.68s 听起来像 1s 停顿。扩展范围到 [279.82, 281.46] 后解决。

### 上下文判断
如果静音前后是同一话题的连续表达，即使稍长（1.5-2秒）也可以保留。
如果静音看起来是剪辑事故或技术问题，即使短于2秒也应删除。
