<!--
input: subtitles_words.json
output: 填充词索引列表
pos: 规则，人工确认优先级（播客版：更宽松）

架构守护者：一旦我被修改，请同步更新：
1. 所属文件夹的 README.md
-->

# 填充词检测（播客版）

## 填充词列表

```javascript
const fillerWords = ['嗯', '啊', '哎', '诶', '呃', '额', '唉', '哦', '噢', '呀', '欸', '那个', '就是', '然后'];
```

## 播客处理原则

**重要**：播客中的填充词是自然对话的一部分，不要过度删除！

### 保留场景
1. **单个填充词**：通常保留，增加自然感
2. **思考停顿**："嗯..."表示思考时保留
3. **情感表达**："啊！"、"哦～"表达情感时保留
4. **对话反应**：对方说话后的"嗯"、"对"表示聆听，应保留

### 建议删除场景
1. **句首单独的"嗯"/"呃"/"啊"**：句子前 1-2 个词是填充词（"嗯"、"呃"、"啊"、"嗯，"、"呃，"等）且后面紧跟实质内容，删除该填充词（精剪词级删除，不删整句）。**这是最高优先级的精剪规则，必须检测**。
   - 匹配模式：句子文本以 `嗯[，、]?|呃[，、]?|啊[，、]?` 开头
   - 删除范围：填充词本身 + 紧随的逗号/顿号（如有）
2. **连续3个以上**："嗯嗯嗯"、"啊啊啊"
3. **明显卡顿**："呃呃...那个那个..."
4. **无意义重复**：快速重复的"就是就是就是"

## 删除边界（极重要！）

```
❌ 错误：删填充词时间戳 (填充词.start - 填充词.end)
   → 前面残留 onset 泄露（弱弱的声音），后面残留不自然静音

✅ 正确：从前一个词的 end 到后一个词的 start
   → [前词.end, 后词.start]
```

### 为什么必须扩展范围？

ASR 时间戳有两个已知问题：

1. **onset 泄露**：填充词实际发声比 ASR 报告的 start 更早。只删 `[filler.start, filler.end]` 会残留一小段弱音。
2. **尾部间隙**：填充词 end 到下一个词 start 之间的静音，删完填充词后这段静音会变成不自然的停顿。

### 实战案例

| 填充词 | ASR时间戳 | 扩展后范围 | 说明 |
|--------|-----------|-----------|------|
| S11"嗯" | [58.67, 59.03] | [58.67, 59.39] | 后扩到下一词 start |
| S24"嗯" | [147.31, 147.91] | [147.07, 148.61] | 前扩到"因为".end，后扩到"我".start |
| S26"嗯" | [156.77, 156.89] | [156.17, 156.97] | 前后都扩展 |
| S28"呃" | [168.49, 169.41] | [167.77, 169.41] | 前扩到"很多。".end |

## 句中单字填充词（精剪重点！）

> **数据来源**：2026-03-01 反馈，46 个 stutter 漏检中 ~35 个是句中单字填充词（啊/呃/对）。

当前规则只检测**句首**填充词，但实际播客中大量漏检发生在**句中**。以下场景应标记删除：

### 句中"呃/啊"紧邻指示词

模式：`...的呃/啊 + 实质内容` 或 `...这个呃/啊 + 实质内容`

填充词出现在"的"、"这个"、"一个"等结构词之后，是说话人组织语言时的犹豫，删除后句子更流畅。

| 原文 | 删除 | 说明 |
|------|------|------|
| 我自己的**啊**这个经历 | 啊 | "的"后犹豫 |
| 一个**呃**专业 | 呃 | "一个"后犹豫 |
| 这个**呃**比较STATE OF THE ART | 呃 | "这个"后犹豫 |
| 觉得**呃**这不是我特别感兴趣的 | 呃 | 动词后犹豫 |
| 是我**呃**第一个没有想到的 | 呃 | 判断词后犹豫 |
| 大概**呃**大几十个人 | 呃 | 数量词间犹豫 |

### 句中"啊"夹在逗号间

模式：`...X，啊，Y...` 或 `...X，啊Y...`

句中"啊"被逗号/停顿包裹，不承载语义，是换气或犹豫。

| 原文 | 删除 | 说明 |
|------|------|------|
| 再怎么样，**啊**，其实这个如果碰到 | 啊 | 逗号间犹豫 |
| 2017年左右**啊**，如果你想要 | 啊 | 时间后犹豫 |
| 一些更加叫第一性原理...啊...THINKING | 啊 | 中英切换间犹豫 |

### 句中口头禅"对"

模式：`...内容，对，继续内容...`

"对"作为口头禅插入句中（不是对话回应），前后有实质内容且"对"不承载语义。

| 原文 | 删除 | 说明 |
|------|------|------|
| 短时间内，**对**，比较快的去 | 对 | 句中口头禅 |
| 这个可能是我啊，**对**，跟我最后决定 | 对 | 句中口头禅 |
| 先先解释一下，**对**，然后我自己 | 对 | 句中口头禅 |

### 检测规则

```javascript
// 句中填充词检测（补充句首检测）
// 条件：
// 1. 词是 啊/呃/额/对 且不在句首位置
// 2. 前后都有实质内容词（非填充词）
// 3. 词时长 < 0.5s（排除感叹/强调用法）
// 4. 不是对话回应（"对"独占整句 → 保留）
function isMidSentenceFiller(word, prevWord, nextWord, isFirstWord) {
  const MID_FILLERS = new Set(['啊', '呃', '额', '对']);
  if (!MID_FILLERS.has(word.text)) return false;
  if (isFirstWord) return false; // 句首由原有规则处理
  if (word.end - word.start > 0.5) return false; // 长音 = 感叹/强调
  if (!prevWord || !nextWord) return false; // 句尾保留
  return true;
}
```

### 与保留规则的区别

| 场景 | 处理 | 原因 |
|------|------|------|
| "嗯，对" 独占整句 | 保留 | 对话回应 |
| "对对对" 表示赞同 | 保留 | 情感表达 |
| 句中 "...X，对，Y..." | 删除 | 口头禅，无语义 |
| "啊！" 感叹语气 | 保留 | 情感表达（时长 >0.5s） |
| 句中 "...的啊这个..." | 删除 | 犹豫填充 |

## 用户偏好（播客默认）

- **默认保留单个填充词**：保持对话自然
- **连续才处理**：只有明显过度才删除
- **尊重说话风格**：有些主播的"嗯"是风格特色
- **对话类保守**：多人对话时更保守，保留反应词

## AI 分析提示

标记时添加理由，例如：
```
| 45 | 10.2-10.4 | 嗯，我觉得... | 句首"嗯"，精剪删除 | 删（词级） |
| 52 | 12.1-12.3 | 嗯 | 句中单个，回应对话 | 保留 |
| 67-69 | 15.6-16.1 | 嗯嗯嗯 | 连续3个 | 删 |
```
