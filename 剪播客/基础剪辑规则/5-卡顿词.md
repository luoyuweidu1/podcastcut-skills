<!--
input: 全文文本
output: 卡顿词索引列表
pos: 规则，建议删优先级

架构守护者：一旦我被修改，请同步更新：
1. 所属文件夹的 README.md
-->

# 卡顿词

## 模式

同一个词连续说 2-3 次：

```javascript
const stutterPatterns = [
  '那个那个',
  '然后然后',
  '这个这个',
  '所以所以'
];
```

## 叠词排除（重要！避免误判）

以下中文叠词是**正常表达**，不是卡顿，**必须跳过**：

```javascript
const REDUPLICATED_WORDS = new Set([
  // AA 式：亲属称谓
  '妈妈', '爸爸', '宝宝', '哥哥', '姐姐', '弟弟', '奶奶', '爷爷',
  '叔叔', '阿姨', '婆婆', '公公', '舅舅', '姑姑', '伯伯',
  // AA 式：日常用语
  '谢谢', '星星', '多多', '甜甜', '乖乖', '饭饭',
  // 拟声/口语表达（不是卡顿）
  '巴拉', // "巴拉巴拉" = "blah blah"，口语中表示省略列举
  // 动词重叠 AA 式
  '试试', '看看', '想想', '说说', '聊聊', '走走', '听听', '等等',
  '谈谈', '讲讲', '写写', '读读', '坐坐', '玩玩', '猜猜', '问问',
  // 拟声叠词
  '哈哈', '嘻嘻', '呵呵', '嘿嘿', '噗噗',
]);

// 拟声叠词 AAA/AAAA 模式（如"哈哈哈"、"哈哈哈哈"）
const ONOMATOPOEIA_BASES = ['哈', '嘻', '呵', '嘿', '噗', '啦'];

// AAB / ABB 式（如"慢慢地"、"轻轻地"、"好好的"）
const AAX_PATTERNS = /^(.)\1(地|的|儿|来|去|看|说)$/;

// ABB 式（如"粉嘟嘟"、"胖乎乎"、"绿油油"、"白花花"）
// 检测方法：当前单字词连续2次，但前一个词不同 → ABB结构
// "粉" + "嘟" + "嘟" → 前词"粉"≠"嘟" → ABB叠词，不是卡顿
function isABBPattern(words, i) {
  if (words[i].text.length === 1 && i > 0 && words[i-1].text !== words[i].text) {
    return true; // 前一个词不同 → ABB结构
  }
  return false;
}

// AABB 式（如"开开心心"、"高高兴兴"、"平平安安"）
const AABB_PATTERN = /^(.)(.)(\1)(\2)$/;
```

### 排除逻辑

```javascript
function isReduplicated(currentWord, nextWord, fullContext) {
  const combined = currentWord + nextWord;

  // 1. 在叠词白名单中
  if (REDUPLICATED_WORDS.has(combined)) return true;

  // 2. 拟声词连续 ≥2 次（哈哈哈、嘻嘻嘻）
  if (ONOMATOPOEIA_BASES.includes(currentWord) &&
      currentWord === nextWord) return true;

  // 3. AAB/ABB 式：两个相同字 + 后缀
  if (AAX_PATTERNS.test(combined)) return true;

  // 4. AABB 式
  if (AABB_PATTERN.test(combined)) return true;

  return false;
}
```

**关键原则**：如果两个相邻的相同词组合在一起是一个有意义的中文词语（叠词），则不是卡顿。**宁可漏检，不可误删正常叠词**。

### 咬字不清 ≠ 卡顿（重要！来自 restore 反馈）

> **数据来源**：2026-03-01 反馈，S83"思思维"被 AI 删除后用户 restore，理由"不应该删除"。

说话人口齿不清导致首字重复（如"思思维"="思维"），在听感上仍可理解为完整词汇。这类**不应标记为卡顿**，因为删除一个字后反而破坏词的完整性。

| 原文 | AI 判断 | 正确处理 | 原因 |
|------|---------|----------|------|
| 思**思**维 | ❌ 删"思" | ✅ 保留 | 咬字不清，听感=思维 |
| 自**自**己 | ❌ 删"自" | ✅ 保留 | 咬字不清，听感=自己 |

**判断标准**：如果"AA + B"中 "AB" 是一个完整词汇（如"思维"、"自己"），则视为咬字不清而非卡顿，保留不删。

## 播客自然重复豁免（播客模式专用）

播客是口语对话，短词重复是自然语流节奏，不同于正式场合的卡顿。

### 豁免规则

**单音节高频词重复默认保留**：以下单音节词连续重复时，在播客里听感自然，**不标记为卡顿**：

```javascript
const PODCAST_NATURAL_REPEATS = new Set([
  // 人称代词
  '我', '你', '他', '她', '它',
  // 高频副词/连词
  '就', '去', '不', '也', '都', '在', '又', '很', '太', '但', '还',
  // 高频动词
  '是', '有', '会', '能', '要', '想', '做', '说', '看', '来', '拉',
]);
```

**多音节词重复**：2字及以上的词连续重复，需区分"高频口语词组"和"真卡顿"：

```javascript
// 高频口语词组重复也应保留（播客里听感自然）
const PODCAST_NATURAL_PHRASES = new Set([
  '就是', '怎么', '真的是', '真的', '然后',
  '可能', '其实', '应该', '已经', '这样',
]);
```

| 类型 | 示例 | 处理 | 判断依据 |
|------|------|------|----------|
| 单音节自然重复 | 就就、我我、去去、不不 | ✅ 保留 | 在 PODCAST_NATURAL_REPEATS |
| 高频口语词组重复 | 就是就是、怎么怎么、真的是真的是 | ✅ 保留 | 在 PODCAST_NATURAL_PHRASES |
| 真卡顿 | 来自来自、塑造塑造、困扰困扰 | ❌ 删除 | 不在任何豁免名单 |
| 叠词 | 妈妈、看看、哈哈 | ✅ 保留 | 已有叠词规则 |

**数据来源**：用户 xiaoqunzi 的样本学习（18 个 AI 标记的卡顿词）：
- 8 个单音节重复：用户全部保留 → PODCAST_NATURAL_REPEATS 正确豁免 ✅
- 4 个高频口语词组重复（就是就是、怎么怎么、真的是真的是、拉拉）：用户全部保留 → PODCAST_NATURAL_PHRASES 正确豁免 ✅
- 6 个真卡顿（最最、困扰困扰、如何如何、来自来自、我就我就、塑造塑造）：用户全部删除 → 正确标记 ✅

**用户差异注意**：
- xiaoqunzi（宽松派）：2x 自然重复全部保留
- lucia（严格派）：2x 重复中 "我我"、"对对" 仍标为漏检；"这个"×5 也要求删
- **结论**：NATURAL_REPEATS 豁免作为默认值，但当重复 ≥3 次时必须标记（不论词是否在豁免列表）。2x 重复是否删除取决于用户 aggressiveness 设置：moderate/aggressive 应删，conservative 可保留

## 数字量词豁免（重要！极高误判率）

数字 + 量词的组合（如"100份"、"一万多块钱"、"985"）在转录中常被拆成多个词，看起来像重复但实际是完整数字表达。**必须豁免**。

### 豁免规则

```javascript
// 数字相关词：阿拉伯数字、中文数字、量词
const NUMBER_CHARS = /^[\d一二三四五六七八九十百千万亿零两几多半]+$/;
const MEASURE_WORDS = new Set(['个', '份', '块', '元', '万', '亿', '年', '月', '天', '次', '遍', '种', '条', '只']);

// 如果连续重复的词是数字或数字的一部分 → 不是卡顿
function isNumberContext(words, i) {
  const w = words[i].text;
  const next = words[i+1] ? words[i+1].text : '';
  const prev = words[i-1] ? words[i-1].text : '';

  // "100" + "份" → 数字量词，不是卡顿
  if (NUMBER_CHARS.test(w) || NUMBER_CHARS.test(next) || NUMBER_CHARS.test(prev)) return true;
  // "一万" + "多" + "块钱" → 数字表达
  if (MEASURE_WORDS.has(w) || MEASURE_WORDS.has(next)) return true;
  return false;
}
```

**真实案例**：
| 原文 | 转录拆分 | AI 判断 | 正确处理 |
|------|----------|---------|----------|
| 你可能投100份简历 | "100" "份" | ❌ 标为 stutter | ✅ 数字量词，保留 |
| 一万多块钱 | "一万" "多" "块钱" | ❌ 标为 stutter | ✅ 数字表达，保留 |
| 100万 | "100" "万" | ❌ 标为 stutter | ✅ 数字，保留 |
| 985 | "985" | ❌ 标为 stutter | ✅ 专有数字，保留 |

## 扩展模式：任意词连续重复

除固定列表外，**任何词连续出现2次**都应检测为卡顿词，**但必须先排除叠词和数字**：

```javascript
// 动态检测：相邻两个相同词（排除叠词 + 数字）
if (words[i].text === words[i+1].text && words[i].text.length >= 1) {
  if (!isReduplicated(words[i].text, words[i+1].text) && !isNumberContext(words, i)) {
    // 卡顿词，删前面保留后面
  }
}
```

### 常见遗漏案例

| 原文 | 卡顿词 | 删除 |
|------|--------|------|
| 第一第一份工作 | 第一 | 前一个"第一" |
| 我我最近 | 我 | 前一个"我" |
| 但但是 | 但 | "但" |
| 放放到台面 | 放 | 前一个"放" |

**关键**：不要只依赖固定列表，任何相邻重复词都是卡顿。

### 连续 ≥3 次重复必须全部清理

> **数据来源**：2026-03-01 反馈，S112"都都都都都被 lay off" 用户反馈"少删了一个都"。

当同一个词连续出现 ≥3 次时（即使该词在 PODCAST_NATURAL_REPEATS 中），**必须删到只剩 1 个**。自然重复豁免仅适用于 2 次重复。

| 原文 | 删除 | 保留 |
|------|------|------|
| 都都都都都被 lay off | 前 4 个"都" | "都被 lay off" |
| 一个一个一个新的技术 | 前 2 个"一个" | "一个新的技术" |
| 更更更align | 前 2 个"更" | "更align" |

## 删除策略

删前面，保留最后一个。

```
原文: "那个那个我想说"
删除: "那个"
保留: "那个我想说"

原文: "第一第一份工作"
删除: "第一"
保留: "第一份工作"
```
