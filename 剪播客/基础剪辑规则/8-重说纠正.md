<!--
input: subtitles_words.json
output: 重说纠正索引列表
pos: 规则，建议删优先级

架构守护者：一旦我被修改，请同步更新：
1. 所属文件夹的 README.md
-->

# 重说纠正

## 模式

说错后立即纠正，删除前面错误的部分。

### 1. 部分重复

前后词语有重叠但不完全相同：

| 原文 | 删除 |
|------|------|
| 你再关你关掉 | "你再关" |
| 怎么让它去有个更大的 | "怎么让它去" |

### 2. 否定纠正

用否定词纠正刚说的：

| 原文 | 删除 |
|------|------|
| 它是它不是 | "它是" |
| 可以不可以 | "可以" |

### 3. 词被打断

词说一半 + 静音 + 重说完整：

| 原文 | 删除 |
|------|------|
| 依赖[静]依赖关系 | "依赖[静]" |

### 4. 句中半截重说

说到一半发现错了，换个说法重新开始。前面半截不完整的部分应删除：

| 原文 | 删除 | 说明 |
|------|------|------|
| 去裁了只被我困在 | "去裁了只被" | 说错后重新组织语言 |
| 五年之这五年间 | "五年之" | "五年之"是半截，后面纠正为"这五年间" |
| 你的对你对世界的 | "你的对" | "你的对"是半截，纠正为"你对世界的" |

### 5. 指代修正

前后主语或修饰语改变：

| 原文 | 删除 | 说明 |
|------|------|------|
| 你的对你对世界的观察 | "你的对" | 改了修饰结构 |

### 6. 粒子结尾 false start（语气词结尾的假启动）

短语以语气词（呢/啊/吧/嘛）结尾，紧接着是更完整的重述版本：

| 原文 | 删除 | 说明 |
|------|------|------|
| 上一期**呢**在上一期的超越百岁里边 | "上一期呢" | "呢"标志着一个被放弃的开头，"在上一期的..."是完整重述 |
| 关于继续我们继续讲关于这个 | "关于继续" | "关于继续"是拼凑的假启动，"我们继续讲关于..."是正确表达 |

**检测要点**：语气词通常用于句尾表示语气，出现在**句中**且后面紧跟相似内容时，大概率是 false start。

### 7. 同头扩展

相同开头的短语出现两次，第二次更完整：

| 原文 | 删除 | 说明 |
|------|------|------|
| 是一个底层，是一个底层 boss | "是一个底层，" | 第二次加了 "boss"，更完整 |
| 在人身上在人身上电 | "在人身上" | 第二次加了 "电"，更完整 |
| 比较慢的一个比较慢速的 | "比较慢的" | "慢速"比"慢"更精确 |
| 中枢神经系统好像中枢神经系统没办法去 | "中枢神经系统好像" | 第二次换了更明确的谓语 |

**检测要点**：滑动窗口（8-12词）内找 ≥2 字的公共前缀出现两次，后者更长/更完整 → 删前者。

### 8. 近义重述

同一语义用不同措辞说了两次：

| 原文 | 删除 | 说明 |
|------|------|------|
| 睡了一睡睡觉一晚上 | "睡了一睡" | "睡了一睡"半截，"睡觉一晚上"是完整版 |
| 但其实更重要，但其实呃应该是。 | "但其实呃应该是。" | 第二次没说完就放弃了，保留第一次 |

**检测要点**：需要语义理解，纯规则很难检测。LLM 应判断哪个版本更完整/通顺。

> **用户反馈 (lucia 2026-02-24)**：14 个 self_correction 漏检，占漏检总数 54%。以上模式 6-8 均来自该期 feedback。

### 9. 重启信号词（规则层可检测） 🆕

说话人明确说出重启信号后重新开始：

| 原文 | 删除 | 信号词 |
|------|------|--------|
| hello，大家好，等一下hello，大家好 | "hello，大家好，等一下" | 等一下 |
| 我们来讨论一下，不对，我们来讨论 | "我们来讨论一下，不对，" | 不对 |

**信号词列表**：等一下、重来、再说一遍、再来、重新说、重新来、不对、说错了、我重说、再来一遍

**检测逻辑（规则层，`run_fine_analysis.js`）**：
1. 在句内扫描信号词
2. 对比信号词前后的文本（取前 N 个词，N ≤ 5）
3. 字符重叠率 ≥ 60% → 判定为 false start
4. 删除：第一遍 + 信号词；保留：第二遍

**优势**：确定性 pattern，不依赖 LLM，100% 准确。

### 10. 名词/量词纠正（错名词 → 正确名词）

说话人用了错误的名词/量词，紧接着纠正为正确的。

| 原文 | 删除 | 说明 |
|------|------|------|
| 呃上海大学的老师，复旦大学的老师 | "呃上海大学的老师，" | 大学名说错，纠正为复旦 |
| 有一段，有几段工作经验 | "有一段，" | 量词"一段"纠正为"几段" |
| 一些啊几门课 | "一些啊" | "一些"纠正为更精确的"几门" |

**检测要点**：句内出现"X的Y，Z的Y"或"有A，有B"结构，且 X≠Z / A≠B，前者是错误版 → 删前者。

### 11. 中断重启（说到一半停顿后换说法）

| 原文 | 删除 | 说明 |
|------|------|------|
| 一年以后或者拿拿到 | "一年以后或者" | "或者"标志中断，后面是新表达 |
| 一个工作的经历，我或者我第一份工作 | "一个工作的经历，我或者" | "或者"标志重述 |

**检测要点**："或者"出现在句中且前后描述同一件事 → 前面是被放弃的版本。

### 12. 插入式卡顿（"是也是"、"改变我的改变"）

句中多余的部分词重复，结构上是"X Y X"，其中第一个 X 是多余的假启动。

| 原文 | 删除 | 说明 |
|------|------|------|
| 这个**是**也是一个 | "是" | "是"是假启动，"也是"是正确表达 |
| 改变**我的改变**我的情况 | "我的改变" | "改变我的改变我的" → 删中间的"我的改变" |
| 可以**去**可以去做的 | "去" | 第一个"去"是假启动 |

## 过度删除防护（从 restore 反馈学习）

> **数据来源**：2026-03-01 反馈，11 个 restore 中 6 个是 self_correction 过度删除。

### 铁律：精确重复"X X"只删一个 X

当完全相同的短语紧邻出现两次时，**只删一个**（通常删前一个），不能两个都删。

| 原文 | ❌ 错误删除 | ✅ 正确删除 |
|------|------------|------------|
| 这条路**这条路**更适合我 | "这条路这条路" | "这条路" (一个) |
| 蛮多的**蛮多的**这个信息 | "蛮多的蛮多的" | "蛮多的" (一个) |
| 能够在**能够在**一个很大规模 | "能够在能够在" | "能够在" (一个) |
| 没有被啊**没有被**这个创造过 | "没有被啊没有被" | "没有被啊" (一个) |
| 都没有特别的，**都没有特别的** | "都没有特别的，都没有特别的" | "都没有特别的，" (一个) |

**实现要点**：检测到"X X"模式时，`deleteRange` 只覆盖第一个 X 及中间的犹豫词（如"啊"），保留第二个完整 X。

### 铁律：口语中的"错音"不是独立删除对象

说话人咬字不清导致的发音错误，如果整体语义可理解，不要把"错音"单独删掉。

| 原文 | ❌ 错误删除 | ✅ 正确处理 |
|------|------------|------------|
| 思**思**维 | 删"思" | 保留原样（"思思维"听感=思维） |
| 一**几**段经验 | 删"一" | 保留原样（"一几段"是口语自然修正） |
| 经**有**经济价值 | 删"经有" | 保留原样（"经有经济"听感=经济） |

**判断标准**：如果删除后反而破坏了语句的完整性（如只剩"几段"但缺了量词感），就不应该删。

## 检测逻辑

```javascript
// 方法1：找相邻词的公共前缀
if (word[i].text.startsWith(prefix) && word[i+n].text.startsWith(prefix)) {
  // 且后者更完整 → 删前者
}

// 方法2：窗口扫描 — 在 8-12 词窗口内找重复起始词
// "五年之...这五年间" → "五年" 出现两次，前面那截不完整 → 删
// "你的对...你对世界的" → "你" 出现两次，前面那截不完整 → 删
// "是一个底层，...是一个底层boss" → "是一个底层" 出现两次，后者更完整 → 删前者
// 关键：后面的版本比前面的更完整/通顺

// 方法3：粒子结尾检测 — 句中的语气词后跟相似内容
// "上一期呢在上一期的..." → "上一期"出现两次，第一次以"呢"结尾 → 大概率 false start
// "关于继续我们继续讲关于..." → "关于/继续"出现两次 → false start
```

**难点**：这类重说不一定有公共前缀，而是"说了几个字发现不对→停顿→换说法重来"。需要结合 AI 语义理解判断哪部分是废弃的半截。

**LLM 层自查清单**（每句必检）：
1. 句中是否有 ≥2 字的短语在附近重复出现？→ 可能是模式 1/4/7
2. 句中是否有语气词(呢/啊/吧)出现在非句尾位置？→ 可能是模式 6
3. 删掉嫌疑片段后，句子是否更通顺？→ 如果是，大概率需要删
4. 近义词/同义表达是否出现两次？→ 可能是模式 8

## 删除边界原则（极重要！）

**只删卡顿/错误前缀，保留最终正确表达。** 这是重说纠正最容易犯错的地方。

### ❌ 常见错误：过度删除

| 原文 | 错误删除 | 结果 | 问题 |
|------|----------|------|------|
| 就是就是努力。 | "就是就是努力。" | 整句没了 | "努力"是关键语义 |
| 但最后最后其实我也没当上 | "但最后" | 失去"但"连接词 | "但"有语义作用 |
| 怎么能能能能能做到，对吧？ | 整句 | 整句没了 | 内容完全丢失 |
| 所以我觉得啊，我的第二个关键词可能就是就是就是探索。 | 整句 | 整句没了 | 关键内容"第二个关键词是探索"丢失 |

### ✅ 正确做法

| 原文 | 正确删除 | 保留 |
|------|----------|------|
| 就是就是努力。 | "就是" | "就是努力。" |
| 但最后最后其实我也没当上 | "最后"（一个重复） | "但最后其实我也没当上" |
| 怎么能能能能能做到，对吧？ | "能能能能" | "怎么能做到，对吧？" |
| 所以我觉得啊...就是就是就是探索。 | "就是就是" | "...就是探索。" |

### 三条铁律

1. **保留语义连接词**：但、所以、然后、因为等连接词有语义作用，即使出现在卡顿附近也不能删
2. **保留最终完整表达**：卡顿 N 次后的最后一次是正确版本，必须保留
3. **复杂句拆分处理**：一句中有多处卡顿时，拆成多个独立小编辑，每个只处理一个卡顿点

### 复杂句拆分示例

原文：`对，然后但最后最后其实我也没当上产品经理啊，这是一个但这但这个是有原因的了。`

拆成两个独立编辑：
- 编辑1：删"最后"（'最后最后'卡顿，只删一个重复）
- 编辑2：删"这是一个但这"（保留'但这个是有原因的了'）

结果：`对，然后但最后其实我也没当上产品经理啊，但这个是有原因的了。`
